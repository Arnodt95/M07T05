{% extends "news_app/base.html" %}
{% block title %}Newsletters · News{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h1 class="h4 m-0">Newsletters</h1>
    <div class="text-muted small">Curated editions created by journalists.</div>
  </div>

  {% if user.is_authenticated %}
    {% if user.role == "journalist" %}
      <a class="btn btn-outline-primary btn-sm" href="{% url 'newsletter_create' %}">Create newsletter</a>
    {% endif %}
  {% endif %}
</div>

{% if newsletters %}
  <div class="row g-3">
    {% for n in newsletters %}
      <div class="col-md-6 col-lg-4">
        <div class="card shadow-sm border-0 rounded-4 h-100">
          <div class="card-body">
            <span class="badge bg-light text-dark border">Edition</span>
            <h3 class="h5 mt-2 mb-1">
              <a class="text-dark text-decoration-none" href="{% url 'newsletter_detail' n.id %}">
                {{ n.title }}
              </a>
            </h3>
            <div class="text-muted small mb-2">
              By {{ n.author.username }} • {{ n.created_at|date:"M d, Y H:i" }}
            </div>

            <p class="mb-3">{{ n.description|default:""|truncatechars:160 }}</p>

            <div class="d-flex gap-2 flex-wrap">
              <a class="btn btn-sm btn-outline-secondary" href="{% url 'newsletter_detail' n.id %}">Open</a>

              {% if user.is_authenticated %}
                {% if user.role == "editor" or user.id == n.author_id %}
                  <a class="btn btn-sm btn-outline-primary" href="{% url 'newsletter_edit' n.id %}">Edit</a>
                {% endif %}
              {% endif %}
            </div>

          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-info">No newsletters yet.</div>
{% endif %}
{% endblock %}

